<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    

    <title>Gauge Test1</title>
    
    <style>
    body {
        padding: 0;
        margin: 0;
        background: #fff
    }
    
    .inputWidth
    {
        width: 20%;
    }
    </style>
</head>
<body style="background-color:#ffffcc">
    <p style="margin-left:80%;" class="p-3">
        <a class="btn btn-primary" data-bs-toggle="collapse" id="settings" href="collapseExample1" onclick="" role="button" aria-expanded="false" aria-controls="collapseExample collapseExample1">
          Settings
        </a>
        
    </p>
      <br>
      <div class="collapse  p-3 pt-0 " id="collapseExample">
        <div class="card card-body" style="background-color:#38b2ff">
            <div class="row">
        <div class=" mt-4 col-lg-12  col-md-6  text-center"> 

            <label class="form-label p-2 mt-2" style="font-weight:bold">Enter Password</label>
                <input type="password" class="form-control d-inline inputWidth m-1" id="password">
                <button type="button" class="btn d-inline btn-primary mx-1 mt-0" onclick="savePassword()">Submit</button>
                <p id="wrongpassword" style="color: red;"></p>
        </div>
    </div>
      </div>
    </div>
      <div class="collapse p-3 pt-0 " id="collapseExample1">
        <div class="card card-body" style="background-color:#38b2ff">
            
            <form class="row">
                <div class="col-3">

                    <label for="GaugesSelector" class="form-label">Gauges To Mesaure</label>
                <select id="GaugesSelector" name="GaugesSelector" onchange="GaugesSelectorChange()">
                    <option value="gauge-1">gauge-1</option>
                    <option value="gauge-2">gauge-2</option>
                    <option value="gauge-3">gauge-3</option>
                  </select>
                  
                
                </div>

                <div class="col-2">
                    <label for="MeasuresSelect" class="form-label">Measures</label>
                   
                     <select id="MeasuresSelect" name="MeasuresSelect" onchange="MeasuresSelectChange()">
                    
                     </select>
                </div>

                <div class="col-2">
                    <label for="MesauringUnits" class="form-label">MesauringUnits</label>
                <select id="MesauringUnits" name="MesauringUnits">
                    
                  </select>
                    
                </div>

                <div class="col-2">
                    <label for="SecondaryUnits" class="form-label">SecondaryUnits</label>
                <select id="SecondaryUnits" name="SecondaryUnits">
                    
                  </select>
                 

                </div>


                <div class="col-3">
                    
                    <label for="GaugeColor" class="form-label">Gauge Color</label>
                <select id="GaugeColor" name="GaugeColor">
                    <option value="white">White</option>
                    <option value="black">black</option>
                    <option value="green">green</option>
                    <option value="aqua">aqua</option>
                    <option value="purple">purple</option>
                    <option value="blue">blue</option>
                    <option value="yellow">yellow</option>
                  </select>

                  <input type="button"  class="  btn btn-primary btn-sm m-1 d-inline " id="unitbutton" onclick="removeColor()" value="remove">
                  <input type="text" name="" id="colorInput" style="width:50%" class="form-control d-inline"> 
                  <input type="button"  class="  btn btn-primary btn-sm m-3 " id="unitbutton" onclick="addColor()" value="Add Color">
                  </div>
                  
                  <div class="mb-4">
                  <input type="button"  class="  btn btn-primary btn-sm m-3 " id="unitbutton" onclick="showAddUnitInputs()" value="Add Unit">
                  <input type="button"  class="btn btn-primary btn-sm m-3" id="removebutton" onclick="removeMeasure()" value="remove">
                  <div class="row d-none" id="AddUnitInputs">
                    <div class="col-3">
                        <label for="Measure">Mesaure </label>
                        <input type="text" name="Measure" id="MeasureInput" class="form-control">
                    </div>
                    <div class="col-3">
                        <label for="MeasureUnit">Mesauring Unit </label>
                        <input type="text" name="MeasureUnit" id="MeasureUnitInput" class="form-control">
                    </div>
                    <div class="col-4">
                        <label for="MeasureSecondaryUnit">Mesauring Secondary Unit </label>
                        <input type="text" name="MeasureSecondaryUnit" id="MeasureSecondaryUnitInput" class="form-control">
                    </div>
                    <div class="col-2">
                        <i class="fa fa-plus mt-4" aria-hidden="true" onclick="addUnit()"></i> 
                    </div>
                </div>
                </div>

                  

                  <div class="col-12">
                <input type="file" class="mr-1"> 
                <label for="MaxTime" class="ml-0 d-inline form-label">Max Time</label>
                <select id="MaxTime" name="MaxTimeSelector">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                  </select>
                  <p class="d-inline">sec</p>
                <input type="button" class="m-3" onclick="updateGauge()" value="Submit">
            </div>

                <div class=" mt-4 col-lg-6 col-md-6 text-center">
                    <h3 class="">Low</h3>
                
                    
                    <div >
                        <label  class="form-label">Sensor</label>
                        <input type="number" class="form-control d-inline inputWidth" id="InputLowSensor1" value="-1000">
                        <span class="px-2">X</span>
                        <input type="number" class="form-control d-inline inputWidth" id="InputLowSensor2" value="1">
                    </div>  
                
                    <div style="margin-right: 8.8%;" >
                        <label  class="form-label mt-3">Alarm</label>
                        <input type="number" class="form-control d-inline inputWidth" id="InputAlarmLow" value="20">
                        <span class="px-2">%</span>
                        <div class="d-inline-block form-check">
                            <input type="checkbox" class="form-check-input" id="AlarmCheckLow" checked>
                            <label class="form-check-label" >Enable</label>
                          </div>
                    </div>
                
            </div>
            <div class="mt-4 col-lg-6 col-md-6 text-center">
                <h3 class="">High</h3>
            
                
                <div >
                    <label class="form-label">Sensor</label>
                    <input type="number" class="form-control d-inline inputWidth" id="InputHighSensor1" value="1000"> 
                    <span class="px-2">X</span>
                    <input type="number" class="form-control d-inline inputWidth" id="InputHighSensor2" value="1">
                </div>  
            
                <div style="margin-right: 8.8%;" >
                    <label  class="form-label mt-3">Alarm</label>
                    <input type="number" class="form-control d-inline inputWidth" id="InputAlarmHigh" value="80">
                    <span class="px-2">%</span>
                    <div class="d-inline-block form-check">
                        <input type="checkbox" class="form-check-input" id="AlarmCheckHigh" checked>
                        <label class="form-check-label" >Enable</label>
                      </div>
                </div>
            
        </div>

        <div class="text-center"><button type="button" class="btn btn-primary mt-4" onclick="saveOnClick(1)">Save and Return</button></div>
              </form>
        </div>
      </div>
<div>
    <div class="row">
<div class="col-lg-4  text-center">
    <canvas  id="gauge-1"
         data-type="radial-gauge"
         data-animation-duration="500"
         data-min-value="0"
         data-max-value="100000"
         data-major-ticks="0,10000,20000,30000,40000,50000,60000,70000,80000,90000,100000"
         data-exact-ticks="true"
         data-minor-ticks="2000"
         data-highlights='[
         {"from": "", "to": "", "color": "rgba(0,0, 255, .6"},      
         {"from": "", "to": "", "color": "rgba(255, 0, 0, .7)"}
         ]'
         data-width="425"
         data-height="425"
         data-units="Kg"
    ></canvas>
    <div >
        <p style="font-size:120% ; display:inline; font-weight: bold; color: rgb(45, 45, 192);">Lbs</p>
        <input type="number" class="" min="0" max="100000" id="gauge" oninput="animateGauges(this.value,0)">
    </div>
</div>
<div class="col-lg-4  text-center">
    <canvas id="gauge-2" data-type="radial-gauge"
         data-animation-duration="500"
         data-min-value="0"
         data-max-value="100000"
         data-major-ticks="0,10000,20000,30000,40000,50000,60000,70000,80000,90000,100000"
         data-exact-ticks="true"
         data-minor-ticks="2000"
         data-highlights='[
         {"from": "", "to": "", "color": "rgba(0,0, 255, .6)"},      
         {"from": "", "to": "", "color": "rgba(255, 0, 0, .7)"}
         ]'
         data-width="425"
         data-height="425"
         data-units="bar"
    ></canvas>
    <div>
        <p style="font-size:120% ; display:inline; font-weight: bold; color: rgb(45, 45, 192);">psi</p>
        <input type="number" class="" min="0" max="100000" oninput="animateGauges(this.value,1)">
    </div>
</div>
<div class="col-lg-4  text-center">
    <canvas id="gauge-3"  data-type="radial-gauge"
         data-animation-duration="500"
         data-min-value="0"
         data-max-value="100000"
         data-major-ticks="0,10000,20000,30000,40000,50000,60000,70000,80000,90000,100000"
         data-exact-ticks="true"
         data-minor-ticks="2000"
         data-highlights='[
         {"from": "", "to": "", "color": "rgba(0,0, 255, .6)"},      
         {"from": "", "to": "", "color": "rgba(255, 0, 0, .7)"}
         ]'
         data-width="425"
         data-height="425"
         data-units="Ft-Lbs"
    ></canvas>
    <div>
        <p style="font-size:120% ; display:inline; font-weight: bold; color: rgb(45, 45, 192);">Nm</p>
        <input type="number" class="" min="0" max="100000" oninput="animateGauges(this.value,2)">
    </div>
</div>
</div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="script.js"></script>
<script>

const MeasuresMap = new Map();
const SettingsMap = new Map();
var GaugeColors =[];

  window.onload = (event) => {

    let gaugeColors;
    gaugeColors = JSON.parse(localStorage.getItem('GaugeColors'));

    if(gaugeColors != null && gaugeColors.length!=0){
        let colorSelect = document.getElementById('GaugeColor');
        GaugeColors = gaugeColors;
        
        GaugeColors.forEach(
            function(item)
            {
                let option = document.createElement("OPTION");
                option = document.createElement("OPTION");
                option.text = option.value = item;
                colorSelect.appendChild(option);
            }
        )
    }
    


    if(localStorage.getItem('Measures')!=null && localStorage.getItem('Measures') != "{}")
    {
       let Measureslocal = JSON.parse(localStorage.getItem ('Measures'));

        Object.keys(Measureslocal).forEach(
            function(key){MeasuresMap.set (key , Measureslocal[key]);}
        )

        let MeasuresSelect = document.getElementById('MeasuresSelect');

        MeasuresMap.forEach(
            function(value,key)
            {
                let option = document.createElement("OPTION");
                option.text = key;
                option.value = key;
                MeasuresSelect.appendChild(option);
            }
        )

        //let Units = MeasuresMap.get(Array.from(MeasuresMap.keys())[0]);
        let Units ;

        let e = document.getElementById("MeasuresSelect");
        let value = e.options[e.selectedIndex].value;

        Units = MeasuresMap.get(value);
        let MesauringUnits = document.getElementById('MesauringUnits');
        Units.PrimaryMeasuringUnits.forEach(
        function(item){
            let option = document.createElement("OPTION");
            option.text = item;
            option.value = item;
            MesauringUnits.appendChild(option);
        })

        let SecondaryUnits = document.getElementById('SecondaryUnits');
        Units.SecondaryMeasuringUnits.forEach(
        function(item){
            let option = document.createElement("OPTION");
            option.text = item;
            option.value = item;
            SecondaryUnits.appendChild(option);
        })

    }

    if(localStorage.getItem('settings')!=null && localStorage.getItem('settings') != "{}" )
    {
       let Settingslocal = JSON.parse(localStorage.getItem ('settings'));


        Object.keys(Settingslocal).forEach(
            function(key){SettingsMap.set (key , Settingslocal[key]);}
        )

        // let MeasuresSelect = document.getElementById('MeasuresSelect');


        SettingsMap.forEach(
            function(value,key)
            {
                for(let i=0 ; i < document.gauges.length; i++)
                {
                    if(document.gauges[i].options.renderTo.id == key)
                    {
                        let gauge = document.gauges[i];
                        let minVal = JSON.parse(value.min) * JSON.parse(value.minMultiplier);
                        let maxVal = JSON.parse(value.max) * JSON.parse(value.maxMultiplier);
                        let gaugeColor = value.gaugeColor;

                        gauge.options.colorPlate= gaugeColor;
                        gauge.options.minValue = minVal;
                        gauge.options.maxValue = maxVal;
                        gauge.options.majorTicks = calculateMajorTicks(minVal,maxVal,10);

                        if(value.lowAlarmChecked && value.highAlarmChecked){
                            var lowalarm = calculateAlarm(minVal,maxVal,value.lowAlarmPercent);  
                            var highalarm = calculateAlarm(minVal,maxVal,value.highAlarmPercent);  
                           
                            gauge.options.highlights[0].from = minVal
                            gauge.options.highlights[0].to = lowalarm
                            gauge.options.highlights[1].from = highalarm        
                            gauge.options.highlights[1].to = maxVal
                        }
                        else if(value.highAlarmChecked){
                            var highalarm = calculateAlarm(minVal,maxVal,value.highAlarmPercent);  
                            
                                gauge.options.highlights[0].from = ""
                                gauge.options.highlights[0].to =""
                                gauge.options.highlights[1].from = highalarm        
                                gauge.options.highlights[1].to = maxVal
                            }
                        else  if(value.lowAlarmChecked){
                                var lowalarm = calculateAlarm(minVal,maxVal,value.lowAlarmPercent);  
                                gauge.options.highlights[0].from = minVal          
                                gauge.options.highlights[0].to = lowalarm
                                gauge.options.highlights[1].from = ""        
                                gauge.options.highlights[1].to = max =""
                            }
                        else if(!lowAlarmChecked && !highAlarmChecked){
                            gauge.options.highlights[1].from = ""       
                            gauge.options.highlights[1].to = ""
                            gauge.options.highlights[0].from = ""        
                            gauge.options.highlights[0].to = max =""
                        }

                        gauge.update();
                        setAlarm(gauge);

                        
                    }
                }
            }
        )

        if(SettingsMap.get('gauge-1') != undefined){
            document.getElementById("InputLowSensor1").value = SettingsMap.get('gauge-1').min
            document.getElementById("InputLowSensor2").value = SettingsMap.get('gauge-1').minMultiplier
            document.getElementById("InputHighSensor1").value = SettingsMap.get('gauge-1').max
            document.getElementById("InputHighSensor2").value =  SettingsMap.get('gauge-1').maxMultiplier
            document.getElementById("InputAlarmLow").value = SettingsMap.get('gauge-1').lowAlarmPercent
            document.getElementById("InputAlarmHigh").value = SettingsMap.get('gauge-1').highAlarmPercent
            document.getElementById("AlarmCheckLow").checked = SettingsMap.get('gauge-1').lowAlarmChecked
            document.getElementById("AlarmCheckHigh").checked = SettingsMap.get('gauge-1').highAlarmChecked

            var e = document.getElementById("GaugeColor");
            var value = e.options[e.selectedIndex].value;

            let i=0;
            for(;i<e.length;i++)
            {
                if(e.options[i].value == SettingsMap.get('gauge-1').gaugeColor)
                    break;
            }

            document.getElementById("GaugeColor").selectedIndex=i;

        }

    }


    var settings = document.getElementById("settings"); 
    var password = document.getElementById("collapseExample");  
    var settingsconfig = document.getElementById("collapseExample1");  
    var checksettings 

    // var url="script.js";
    
    // url+="?"+new Date().getTime()+Math.floor(Math.random()*1000000);
    // var el=document.createElement('script');

    // el.id="123";
    
    
    // el.src=url;
    // document.body.appendChild(el);
    
    // el.onerror=function(err){
    //     // myFunction()
    //     settings.href = "#collapseExample"; 
    //     checksettings = true
    // }




    // storepassword = "1"
    // //   storepassword = "Cgmp@150"
    //   localStorage.setItem("password", storepassword)
       
        
        settings.href = "#collapseExample";   
        console.log(settings.href);
  };
  
function  GaugesSelectorChange()
    {
        let e = document.getElementById("GaugesSelector");
        let gaugeName = e.options[e.selectedIndex].value;   

        let value =  SettingsMap.get(gaugeName);
        if(value != undefined){
            document.getElementById("InputLowSensor1").value = value.min
            document.getElementById("InputLowSensor2").value = value.minMultiplier
            document.getElementById("InputHighSensor1").value = value.max
            document.getElementById("InputHighSensor2").value =  value.maxMultiplier
            document.getElementById("InputAlarmLow").value = value.lowAlarmPercent
            document.getElementById("InputAlarmHigh").value = value.highAlarmPercent
            document.getElementById("AlarmCheckLow").checked = value.lowAlarmChecked
            document.getElementById("AlarmCheckHigh").checked = value.highAlarmChecked
        }

    }


  function checkSettingsDetails(){
    
    }
    
  function savePassword(){
    
      var password_input = document.getElementById("password").value
      var password_retrieved = localStorage.getItem("password")

      if(password_retrieved == password_input)
    {
        
        document.getElementById("collapseExample").classList.remove("show");
        document.getElementById("collapseExample1").classList.add("show") ;
        settings.href = "#collapseExample1";  
    }
    else{
        settings.href = "#collapseExample";  
        document.getElementById("wrongpassword").innerHTML = "Wrong Password"

    }
        

  }


var input = document.querySelector('input[type="file"]')
input.addEventListener('change', function (e) {
console.log(input.files)
var reader = new FileReader()
reader.onload = function () {
    var lines = reader.result.split('\n').map(function (line){
        return line.split(',');
    })
    console.log(lines);
    addFileData(lines);   
}

reader.readAsText(input.files[0])
}, false)


var newlinedata;
function addFileData(lines) {
    newlinedata = lines;

}


   function updateGauge(){
    var e = document.getElementById("MaxTime");

  var maxTime = e.options[e.selectedIndex].value;
  console.log(maxTime);
  maxTime = maxTime * 1000
  console.log(maxTime)
    function addOneChar(i) {
        var j = 0
        var k = 0

        while (j <= 5)
        {
            newgauge = document.gauges[k]
            if(j %2 == 0) {
    
        newgauge.options.value = newlinedata[i][j+1]
        newgauge.update();
        k++;
        }   
             j++;
             
        }

             
        if (i+1<newlinedata.length-1) {
        setTimeout(function() { addOneChar(i+1); }, maxTime);
    } 
}
addOneChar(0)

}
function removeColor(){
    let colorInput = document.getElementById('colorInput').value.toLowerCase(); 
    let colorSelect = document.getElementById('GaugeColor');
    let localColors = JSON.parse(localStorage.getItem("GaugeColors"));
    console.log(localColors)

    var e = document.getElementById("GaugeColor");
    var colorName = e.options[e.selectedIndex].value;
    e.remove(e.selectedIndex);
    console.log(colorName)
    for(i=0; i < localColors.length; i++){
        console.log(localColors.length)
        console.log(localColors[i].value)

        if(localColors[i] == colorName)
        {
            console.log(localColors[i])
            localColors.splice(i, 1);            
        }

    }
    
    localStorage.setItem('GaugeColors',JSON.stringify(localColors));


}

</script>

<script src="gauge.min.js"></script>

</body>
</html>

<!-- data-major-ticks="0,10000,20000,30000,40000,50000,60000,70000,80000,90000,100000" -->